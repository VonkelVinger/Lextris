<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leximax Game</title>
    <link rel="stylesheet" href="assets/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="icon" type="image/png" href="favicon_L_top_highres.png">
    <style>
        /* Basic styling for the game layout */
        #game-container {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .game-title {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .phrase-display {
            text-align: center;
            font-size: 20px;
            margin-bottom: 20px;
        }
        .keyboard {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .key {
            width: 30px;
            height: 30px;
            margin: 5px;
            text-align: center;
            line-height: 30px;
            font-size: 16px;
            border: 1px solid #ccc;
            cursor: pointer;
            user-select: none;
        }
        .key-disabled {
            background-color: #ddd;
            cursor: not-allowed;
        }
        .message {
            text-align: center;
            margin-top: 20px;
            font-size: 18px;
            color: darkred;
            font-weight: bold;
        }
        .reset-button {
            text-align: center;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <!-- âœ… Game Title -->
    <header>
        <div class="game-title">Leximax - Daily Challenge</div>
    </header>

    <!-- âœ… Game Container -->
    <div id="game-container">
        <div id="phrase-display" class="phrase-display">Loading game...</div>
        <div id="keyboard" class="keyboard"></div>
        <div id="message" class="message"></div>
        <div class="reset-button">
            <button id="reset-button">Restart Game</button>
        </div>
    </div>

    <!-- âœ… Firebase Integration -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Fetch gameId from URL
        const urlParams = new URLSearchParams(window.location.search);
        const gameId = urlParams.get('gameId');

        // Game variables
        let targetWord = '';
        let guessedLetters = new Set();
        let incorrectGuesses = 0;
        let maxGuesses = 6;

        // Initialize game
        async function fetchGame(gameId) {
            try {
                const gameRef = doc(db, 'daily_games', gameId);
                const gameSnap = await getDoc(gameRef);

                if (gameSnap.exists()) {
                    const gameData = gameSnap.data();
                    targetWord = gameData.targetWord.toUpperCase();
                    startGame();
                } else {
                    displayMessage('Game not found.');
                }
            } catch (error) {
                console.error('Error fetching game data:', error);
                displayMessage('Failed to load game. Please try again.');
            }
        }

        // Start Game
        function startGame() {
            renderPhrase();
            renderKeyboard();
        }

        // Display the phrase with hidden letters
        function renderPhrase() {
            const display = targetWord.split('').map(letter => 
                guessedLetters.has(letter) ? letter : '_'
            ).join(' ');
            document.getElementById('phrase-display').textContent = display;

            if (!display.includes('_')) {
                displayMessage('ðŸŽ‰ You won! Great job!');
                disableKeyboard();
            }
        }

        // Create the keyboard
        function renderKeyboard() {
            const keyboardContainer = document.getElementById('keyboard');
            keyboardContainer.innerHTML = '';
            const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';

            alphabet.split('').forEach(letter => {
                const key = document.createElement('div');
                key.textContent = letter;
                key.className = 'key';
                if (guessedLetters.has(letter)) {
                    key.classList.add('key-disabled');
                }
                key.addEventListener('click', () => makeGuess(letter));
                keyboardContainer.appendChild(key);
            });
        }

        // Handle guesses
        function makeGuess(letter) {
            if (guessedLetters.has(letter)) return;

            guessedLetters.add(letter);
            if (!targetWord.includes(letter)) {
                incorrectGuesses++;
                if (incorrectGuesses >= maxGuesses) {
                    displayMessage('ðŸ˜¢ Game Over! The word was: ' + targetWord);
                    disableKeyboard();
                }
            }

            renderPhrase();
            renderKeyboard();
        }

        // Disable keyboard after game ends
        function disableKeyboard() {
            const keys = document.querySelectorAll('.key');
            keys.forEach(key => key.classList.add('key-disabled'));
        }

        // Display messages
        function displayMessage(msg) {
            document.getElementById('message').textContent = msg;
        }

        // Reset game
        document.getElementById('reset-button').addEventListener('click', () => {
            guessedLetters.clear();
            incorrectGuesses = 0;
            startGame();
            displayMessage('');
        });

        // Load Game
        if (gameId) {
            fetchGame(gameId);
        } else {
            displayMessage('No game specified. Please return to the home page.');
        }
    </script>

    <!-- âœ… Footer -->
    <footer>
        <p>&copy; 2024 Leximax. All rights reserved.</p>
    </footer>
</body>
</html>
