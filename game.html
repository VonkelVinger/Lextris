<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>LEXIMAX</title>
    
    <style>
        /* General Reset and Global Styles */
        * {
            -webkit-tap-highlight-color: transparent;
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }

        body {
            background-color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            min-height: 100vh;
        }

        /* Game Wrapper */
        .game-wrapper {
            width: 100%;
            max-width: 320px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        /* Title Styling */
        #leximax-title {
            display: flex;
            gap: 0;
            margin-bottom: 8px;
        }

        .title-block {
            width: 45px;
            height: 45px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 35px;
            font-weight: bold;
            color: white;
        }

        /* Target Word */
        #target-word-container {
            text-align: center;
            margin-bottom: 8px;
        }

        #target-word-label {
            font-size: 22px;
            margin-bottom: 4px;
            font-weight: bold;
            color: #666666;
        }

        #target-word {
            display: flex;
            gap: 1px;
            justify-content: center;
            background-color: white;
            padding: 1px;
            border: 1px solid #004d40;
        }

        .target-letter {
            width: 25px;
            height: 25px;
            background-color: #004d40;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 16px;
        }

        /* Game Grid */
        #game-grid {
            width: 100%;
            aspect-ratio: 8/10;
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(10, 1fr);
            gap: 1px;
            border: 1px solid #004d40;
        }

        .grid-cell {
            background-color: #004d40;
            width: 100%;
            height: 100%;
        }

        .grid-cell.filled {
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: white;
            font-size: 16px;
        }

        /* Controls */
        #mobile-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 16px;
        }

        .mobile-btn {
            aspect-ratio: 1;
            background-color: #003366;
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 45px;
        }

        #time-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 8px;
        }

        .time-container {
            text-align: center;
            color: white;
            font-weight: bold;
            font-size: 12px;
        }

        #timer-container {
            background-color: #004d40;
        }

        #best-time-container {
            background-color: #d32f2f;
        }

        /* Leaderboard */
        #leaderboard {
            width: 100%;
            max-width: 320px;
            border-collapse: collapse;
            background-color: #f0f0f0;
        }

        #leaderboard caption {
            background-color: #003366;
            color: white;
            font-weight: bold;
        }

        #leaderboard th, #leaderboard td {
            padding: 6px 12px;
            text-align: left;
            border-bottom: 1px solid #cccccc;
        }
    </style>
</head>
<body>
    <div class="game-wrapper">
        <div id="leximax-title">
            <div class="title-block" style="background-color: #2196f3;">L</div>
            <div class="title-block" style="background-color: #f44336;">E</div>
            <div class="title-block" style="background-color: #4caf50;">X</div>
            <div class="title-block" style="background-color: #ffc107;">I</div>
            <div class="title-block" style="background-color: #9c27b0;">M</div>
            <div class="title-block" style="background-color: #0066FF;">A</div>
            <div class="title-block" style="background-color: #900C3F;">X</div>
        </div>

        <div id="target-word-container">
            <div id="target-word-label">TARGET WORD:</div>
            <div id="target-word"></div>
        </div>

        <div id="game-grid"></div>

        <div id="mobile-controls">
            <button class="mobile-btn" id="left-btn">â—€</button>
            <button class="mobile-btn" id="down-btn">â–¼</button>
            <button class="mobile-btn" id="right-btn">â–¶</button>
        </div>

        <div id="time-display">
            <div id="timer-container" class="time-container">Time:<br>00:00</div>
            <div id="best-time-container" class="time-container">Best Time:<br>--:--</div>
        </div>
    </div>

    <table id="leaderboard">
        <caption>LEADERBOARD</caption>
        <thead>
            <tr><th>Rank</th><th>Name</th><th>Time</th></tr>
        </thead>
        <tbody></tbody>
    </table>

    <script src="firebase.js" type="module"></script>
    <script src="game.js" type="module"></script>
</body>
</html>
// Import Firebase dependencies
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
import { 
    getFirestore, 
    doc, 
    getDoc, 
    collection, 
    addDoc, 
    query, 
    orderBy, 
    limit, 
    onSnapshot 
} from "https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore.js";

// Firebase Configuration
const firebaseConfig = {
    apiKey: "AIzaSyC7MGy-7Gh5h1zp6KjuDq2_pRekPvCHrM4",
    authDomain: "leximax-96299.firebaseapp.com",
    projectId: "leximax-96299",
    storageBucket: "leximax-96299.appspot.com",
    messagingSenderId: "1067424610925",
    appId: "1:1067424610925:web:f2d344a474e9bad8b8dd64"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Fetch Game Data
export async function fetchGameData(gameId) {
    try {
        if (!gameId) throw new Error('Game ID is missing.');

        const gameRef = doc(db, 'daily_games', gameId);
        const gameSnap = await getDoc(gameRef);

        if (!gameSnap.exists()) throw new Error(`Game ${gameId} not found.`);

        const data = gameSnap.data();
        console.log('Game Data Loaded:', data);

        return data;
    } catch (error) {
        console.error('Failed to fetch game data:', error.message);
        return null;
    }
}

// Leaderboard Listener
export function setupLeaderboardListener(gameId, updateLeaderboardCallback) {
    try {
        const leaderboardQuery = query(
            collection(db, 'daily_games', gameId, 'leaderboard'),
            orderBy("time"),
            limit(10)
        );

        return onSnapshot(leaderboardQuery, (snapshot) => {
            const leaderboard = [];
            snapshot.forEach((doc) => {
                leaderboard.push({
                    name: doc.data().name || 'Anonymous',
                    time: doc.data().time || '--:--'
                });
            });
            updateLeaderboardCallback(leaderboard);
        });
    } catch (error) {
        console.error('Failed to set up leaderboard listener:', error.message);
    }
}

// Add Leaderboard Entry
export async function addLeaderboardEntry(gameId, playerName, time) {
    try {
        const leaderboardRef = collection(db, 'daily_games', gameId, 'leaderboard');
        await addDoc(leaderboardRef, {
            name: playerName.slice(0, 12) || 'Anonymous',
            time: time,
            timestamp: new Date().toISOString()
        });
        console.log('Leaderboard entry added.');
    } catch (error) {
        console.error('Failed to add leaderboard entry:', error.message);
    }
}
import { fetchGameData, setupLeaderboardListener, addLeaderboardEntry } from './firebase.js';

// Game State Variables
let TARGET_WORD = '';
let GAME_ID = '';
let grid = [];
let currentBlock = null;
let nextBlock = null;
let gameInterval = null;
let gameTime = 0;
let isPaused = false;
let isGameOver = false;
let isMoving = false;

// Constants
const GRID_WIDTH = 8;
const GRID_HEIGHT = 10;
const COLORS = ['#2196f3', '#f44336', '#4caf50', '#ffc107', '#9c27b0', '#003366', '#009688'];
const LETTERS = 'BCDFGHJKLMNPQRSTVWXZ';
const VOWELS = 'AEIOUY';

// ðŸŸ¢ **Initialize the Game**
document.addEventListener('DOMContentLoaded', async () => {
    try {
        // Get Game ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        GAME_ID = urlParams.get('gameId');
        if (!GAME_ID) throw new Error('Game ID is missing from the URL.');

        // Fetch Game Data
        const gameData = await fetchGameData(GAME_ID);
        if (!gameData) throw new Error('Failed to load game data.');

        TARGET_WORD = gameData.targetWord || 'ERROR';
        displayTargetWord(TARGET_WORD);

        // Setup Leaderboard
        setupLeaderboardListener(GAME_ID, updateLeaderboard);

        // Initialize Game
        initGame();
        setupEventListeners();
    } catch (error) {
        console.error('Game Initialization Error:', error.message);
        document.body.innerHTML = `<h2 style="color: red; text-align: center; margin-top: 50px;">Error: ${error.message}</h2>`;
    }
});

// ðŸŸ¡ **Display Target Word**
function displayTargetWord(word) {
    const targetWordContainer = document.getElementById('target-word');
    if (targetWordContainer) {
        targetWordContainer.innerHTML = word
            .split('')
            .map(letter => `<div class="target-letter">${letter}</div>`)
            .join('');
    } else {
        console.error('Element #target-word not found.');
    }
}

// ðŸŸ¡ **Initialize Grid**
function initGame() {
    initGrid();
    currentBlock = createBlock();
    nextBlock = createBlock();
    drawBlock(currentBlock);
    resetTimer();
}

// ðŸŸ¡ **Initialize Grid Cells**
function initGrid() {
    const gameGrid = document.getElementById('game-grid');
    gameGrid.innerHTML = '';
    grid = Array(GRID_HEIGHT).fill().map(() => Array(GRID_WIDTH).fill(null));

    for (let y = 0; y < GRID_HEIGHT; y++) {
        for (let x = 0; x < GRID_WIDTH; x++) {
            const cell = document.createElement('div');
            cell.className = 'grid-cell';
            cell.setAttribute('data-x', x);
            cell.setAttribute('data-y', y);
            gameGrid.appendChild(cell);
        }
    }
}

// ðŸŸ¡ **Create Blocks**
function createBlock() {
    const color = COLORS[Math.floor(Math.random() * COLORS.length)];
    const letter = Math.random() < 0.3 ?
        VOWELS[Math.floor(Math.random() * VOWELS.length)] :
        LETTERS[Math.floor(Math.random() * LETTERS.length)];
    return { color, letter, x: Math.floor(GRID_WIDTH / 2), y: 0 };
}

// ðŸŸ¡ **Draw Block**
function drawBlock(block) {
    if (!block) return;
    const cell = document.querySelector(`#game-grid .grid-cell[data-x="${block.x}"][data-y="${block.y}"]`);
    if (cell) {
        cell.className = 'grid-cell filled';
        cell.style.backgroundColor = block.color;
        cell.textContent = block.letter;
    }
}

// ðŸŸ¡ **Clear Block**
function clearBlock(block) {
    if (!block) return;
    const cell = document.querySelector(`#game-grid .grid-cell[data-x="${block.x}"][data-y="${block.y}"]`);
    if (cell) {
        cell.className = 'grid-cell';
        cell.style.backgroundColor = '';
        cell.textContent = '';
    }
}

// ðŸŸ¡ **Move Block**
async function moveBlock(dx, dy) {
    if (!currentBlock || isPaused || isGameOver || isMoving) return;

    isMoving = true;
    clearBlock(currentBlock);

    const newX = currentBlock.x + dx;
    const newY = currentBlock.y + dy;
    const testBlock = { ...currentBlock, x: newX, y: newY };

    if (!isCollision(testBlock)) {
        currentBlock.x = newX;
        currentBlock.y = newY;
    } else if (dy > 0) {
        placeBlock();
    }

    drawBlock(currentBlock);
    isMoving = false;
}

// ðŸŸ¡ **Drop Block**
function dropBlock() {
    if (!currentBlock
