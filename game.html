<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>LEXIMAX</title>
    <style>
        * {
            -webkit-tap-highlight-color: transparent;
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }

        body {
            background-color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            min-height: 100vh;
        }

        .game-wrapper {
            width: 100%;
            max-width: 320px;
            background-color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            overflow: hidden;
        }

        #leximax-title {
            display: flex;
            gap: 0;
            margin-bottom: 8px;
        }

        .title-block {
            width: 45px;
            height: 45px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 35px;
            font-weight: bold;
            color: white;
        }

        #target-word-container {
            text-align: center;
            margin-bottom: 8px;
        }

        #target-word-label {
            font-size: 22px;
            margin-bottom: 4px;
            font-weight: bold;
            color: #666666;
        }

        #target-word {
            display: flex;
            gap: 1px;
            justify-content: center;
            background-color: white;
            padding: 1px;
            border: 1px solid #004d40;
        }

        .target-letter {
            width: 25px;
            height: 25px;
            background-color: #004d40;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="game-wrapper">
        <div id="leximax-title">
            <div class="title-block" style="background-color: #2196f3;">L</div>
            <div class="title-block" style="background-color: #f44336;">E</div>
            <div class="title-block" style="background-color: #4caf50;">X</div>
            <div class="title-block" style="background-color: #ffc107;">I</div>
            <div class="title-block" style="background-color: #9c27b0;">M</div>
            <div class="title-block" style="background-color: #0066FF;">A</div>
            <div class="title-block" style="background-color: #900C3F;">X</div>
        </div>

        <div id="target-word-container">
            <div id="target-word-label">TARGET WORD:</div>
            <div id="target-word"></div>
        </div>

        <div id="game-grid"></div>
        <div id="controls">
            <div id="mobile-controls">
                <button class="mobile-btn" id="left-btn">◀</button>
                <button class="mobile-btn" id="down-btn">▼</button>
                <button class="mobile-btn" id="right-btn">▶</button>
            </div>

            <div id="game-buttons">
                <button class="game-btn" id="start-btn">START</button>
                <button class="game-btn" id="pause-btn">PAUSE</button>
            </div>

            <div id="time-display">
                <div id="timer-container" class="time-container">
                    Time:<br>00:00
                </div>
                <div id="best-time-container" class="time-container">
                    Best Time:<br>--:--
                </div>
            </div>
        </div>
    </div>

    <table id="leaderboard">
        <caption>LEADERBOARD</caption>
        <thead>
            <tr>
                <th>Rank</th>
                <th>Name</th>
                <th>Time</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
        import { 
            getFirestore, 
            doc, 
            getDoc, 
            collection,
            addDoc,
            query, 
            orderBy, 
            limit, 
            onSnapshot 
        } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC7MGy-7Gh5h1zp6KjuDq2_pRekPvCHrM4",
            authDomain: "leximax-96299.firebaseapp.com",
            projectId: "leximax-96299",
            storageBucket: "leximax-96299.appspot.com",
            messagingSenderId: "1067424610925",
            appId: "1:1067424610925:web:f2d344a474e9bad8b8dd64"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let TARGET_WORD = '';
        let GAME_ID = '';
        let grid = Array(10).fill().map(() => Array(8).fill(null));
        let currentBlock = null;
        let nextBlock = null;
        let gameTime = 0;
        let isPaused = false;
        let isGameOver = false;
        let gameInterval = null;
        async function initializeGame() {
            try {
                const today = new Date().toISOString().split('T')[0];
                GAME_ID = `Game${today}`;

                const gameDoc = await getDoc(doc(db, 'daily_games', GAME_ID));
                if (!gameDoc.exists()) {
                    throw new Error('No word found for today');
                }

                TARGET_WORD = gameDoc.data().targetWord;
                console.log('Target word loaded:', TARGET_WORD);

                displayTargetWord(TARGET_WORD);

                setupEventListeners();
                updateGrid();
            } catch (error) {
                console.error('Initialization Error:', error.message);
            }
        }

        function displayTargetWord(word) {
            const targetWordDiv = document.getElementById('target-word');
            if (targetWordDiv) {
                targetWordDiv.innerHTML = '';
                for (const letter of word) {
                    const letterDiv = document.createElement('div');
                    letterDiv.className = 'target-letter';
                    letterDiv.textContent = letter;
                    targetWordDiv.appendChild(letterDiv);
                }
            }
        }

        function updateGrid() {
            const gameGrid = document.getElementById('game-grid');
            gameGrid.innerHTML = '';
            for (let y = 0; y < 10; y++) {
                for (let x = 0; x < 8; x++) {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell';
                    if (grid[y][x]) {
                        cell.textContent = grid[y][x].letter;
                        cell.style.backgroundColor = grid[y][x].color;
                    }
                    gameGrid.appendChild(cell);
                }
            }
        }
        function setupEventListeners() {
            document.getElementById('start-btn').addEventListener('click', startGame);
            document.getElementById('pause-btn').addEventListener('click', togglePause);
            document.getElementById('left-btn').addEventListener('click', () => moveBlock(-1, 0));
            document.getElementById('right-btn').addEventListener('click', () => moveBlock(1, 0));
            document.getElementById('down-btn').addEventListener('click', dropBlock);
        }

        function startGame() {
            isPaused = false;
            isGameOver = false;
            currentBlock = createBlock();
            nextBlock = createBlock();
            gameInterval = setInterval(() => {
                if (!isPaused) moveBlock(0, 1);
            }, 1000);
        }
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                await initializeGame();
            } catch (error) {
                console.error('Initialization Error:', error.message);
            }
        });
    </script>
</body>
</html>
