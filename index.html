<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leximax</title>
    <link rel="stylesheet" href="assets/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="icon" type="image/png" href="favicon_L_top_highres.png">
    
    <!-- ✅ Prevent Cookie Banner Flash -->
    <style>
        #cookie-banner {
            display: none;
        }
        html.show-cookie-banner #cookie-banner {
            display: block;
        }
    </style>
    <script>
        (function() {
            const hasAcceptedCookies = localStorage.getItem('cookiesAccepted');
            if (hasAcceptedCookies !== 'true') {
                document.documentElement.classList.add('show-cookie-banner');
            }
        })();
    </script>
</head>
<body>
    <!-- ✅ Header with Game Title -->
    <header>
        <div id="game-title">
            <div class="title-block" style="background-color: #0066FF;">L</div>
            <div class="title-block" style="background-color: #f44336;">E</div>
            <div class="title-block" style="background-color: #4caf50;">X</div>
            <div class="title-block" style="background-color: #ffc107;">I</div>
            <div class="title-block" style="background-color: #9c27b0;">M</div>
            <div class="title-block" style="background-color: #0066FF;">A</div>
            <div class="title-block" style="background-color: #900C3F;">X</div>
        </div>
    </header>

    <!-- ✅ Main Navigation Buttons -->
    <main>
        <div class="buttons-container">
            <a id="todays-game" class="button">TODAY'S GAME</a>
            <a href="archive-games.html" class="button">ARCHIVE GAMES</a>
            <a href="how-to-play.html" class="button">FIRST TIME? HERE'S HOW TO PLAY</a>
        </div>

        <!-- ✅ Ad Section -->
        <section class="ads">
            <h2>Help us keep the game free by supporting our advertisers</h2>
            <div class="ad-container">
                <div class="ad-placeholder">Ad Space 1</div>
                <div class="ad-placeholder">Ad Space 2</div>
            </div>
        </section>

        <!-- ✅ Cookie Banner -->
        <div id="cookie-banner" class="cookie-banner">
            <p>
                This website uses cookies to enhance your experience, personalize ads, and analyze traffic.
                By clicking "Accept All Cookies," you consent to our use of cookies.
                See our <a href="privacy-policy.html" target="_blank">Privacy Policy</a> for more details.
            </p>
            <div class="cookie-buttons">
                <button id="accept-cookies">Accept All Cookies</button>
                <button id="customize-cookies">Customize</button>
            </div>
        </div>
    </main>

    <!-- ✅ Coffee Support Button -->
    <div class="coffee-button"></div>

    <!-- ✅ Footer -->
    <footer>
        <a href="about-leximax.html">About Leximax</a> |
        <a href="privacy-policy.html">Privacy Policy</a> |
        <a href="contact.html">Contact Us</a>
        <p>&copy; 2024 Leximax. All rights reserved.</p>
        <script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js"
            data-name="bmc-button" data-slug="PlayLeximax" data-color="#FFDD00" data-emoji=""
            data-font="Cookie" data-text="Buy me a coffee" data-outline-color="#000000"
            data-font-color="#000000" data-coffee-color="#ffffff"></script>
    </footer>

    <!-- ✅ Firebase Integration for Dynamic Game Linking -->
    <script type="module">
        // Initialize Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore, collection, query, where, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Fetch the most recent active game
        document.addEventListener('DOMContentLoaded', async () => {
            const todaysGameLink = document.getElementById('todays-game');

            try {
                const gamesRef = collection(db, 'daily_games');
                const q = query(
                    gamesRef,
                    where('active', '==', true),
                    orderBy('createdAt', 'desc'),
                    limit(1)
                );

                const querySnapshot = await getDocs(q);

                if (!querySnapshot.empty) {
                    const latestGame = querySnapshot.docs[0];
                    const gameId = latestGame.id; // Example: Game2024-12-23
                    todaysGameLink.href = `game.html?gameId=${gameId}`;
                    console.log('Latest active game:', gameId);
                } else {
                    console.warn('No active games found.');
                    todaysGameLink.href = '#';
                    todaysGameLink.textContent = 'No Active Game Available';
                }
            } catch (error) {
                console.error('Error fetching the latest active game:', error);
                todaysGameLink.href = '#';
                todaysGameLink.textContent = 'Error Loading Game';
            }
        });
    </script>

    <!-- ✅ JavaScript for Cookie Banner -->
    <script>
        document.getElementById('accept-cookies').addEventListener('click', () => {
            localStorage.setItem('cookiesAccepted', 'true');
            document.documentElement.classList.remove('show-cookie-banner');
        });
    </script>

    <!-- ✅ JavaScript File -->
    <script src="scripts.js"></script>
</body>
</html>
